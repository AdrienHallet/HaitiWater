{% extends "base.html" %}
{% load staticfiles %}
{% load django_tables2 %}

{% block page_name %}
    Réseau de distribution
{% endblock %}

{% block page_content %}

    <section class="panel">
        <header class="panel-heading">
            <!-- Table block control actions -->
            <div class="panel-actions form-inline">
                <a href="#" class="fa fa-caret-down"></a>
            </div>
            <h2 class="panel-title">Graphe</h2>
        </header>
        <div class="panel-body">
            <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
            <canvas id="canvas"></canvas>
            <script>
                jsonfile = null;
                dataURL = location.protocol+'//'+location.hostname+(location.port ? ':'+location.port: '') + "/reseau/graph/?type=json";

                $.getJSON(dataURL, function() {
                    console.log("1")
                }).done( function() {
                    console.log("2")
                }).fail( function(e) {
                    console.log(e)
                }).always( function() {
                    console.log("4")
                });

                $.getJSON(dataURL, function(jsonfile) {
                    console.log("INSIDE");
                    console.log(jsonfile.toLocaleString());
                    var labels = jsonfile.jsonarray.map(function(e) {
                       return e.name;
                    });
                    var data = jsonfile.jsonarray.map(function(e) {
                       return e.age;
                    });

                    var ctx = canvas.getContext('2d');
                    var config = {
                       type: 'line',
                       data: {
                          labels: labels,
                          datasets: [{
                             label: 'Graph Line',
                             data: data,
                             backgroundColor: 'rgba(0, 119, 204, 0.3)'
                          }]
                       }
                    };

                    var chart = new Chart(ctx, config);
                });
            </script>
        </div>
    </section>

    <section class="panel">
        <header class="panel-heading">
            <!-- Table block control actions -->
            <div class="panel-actions form-inline">
                <a id="add-form" href="#modalForm" class="modal-with-form fa fa-plus"></a>
                <a href="{% export_url "csv" %}" class="fa fa-print"></a>
                <a href="#" class="fa fa-caret-down"></a>
            </div>
            <h2 class="panel-title">Éléments du réseau</h2>
        </header>
        <div class="panel-body">
            {% include "network_element_table.html" %}
        </div>
    </section>

    <!-- Modal form to add network element -->
    <div id="modalForm" class="modal-block modal-block-primary mfp-hide">
        <section class="panel">
            <header class="panel-heading">
                <h2 class="panel-title">Ajouter un Élément au réseau</h2>
            </header>
            <div class="panel-body">
                <form id="demo-form" class="form-horizontal mb-lg" novalidate="novalidate">
                    <div class="form-group mt-lg">
                        <label class="col-sm-3 control-label">Nom</label>
                        <div class="col-sm-9">
                            <input type="text" name="name" class="form-control" placeholder="J'ai perdu !" required="">
                        </div>
                    </div>
                </form>
            </div>
            <footer class="panel-footer">
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary modal-confirm">Submit</button>
                        <button class="btn btn-default modal-dismiss">Cancel</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>
{% endblock %}

